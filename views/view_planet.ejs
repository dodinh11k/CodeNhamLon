<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= title %></title>
  <link rel="stylesheet" href="/css/style.css?v=1">
  <style>
    .code-container pre { white-space: pre-wrap; word-break: break-word; }
    /* Make planet demo taller like other rich demos */
    .planet-demo { height: 70vh; min-height: 560px; }
  </style>
  <!-- Three.js & OrbitControls from CDN -->
  <script src="https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.158.0/examples/js/controls/OrbitControls.js"></script>
</head>
<body>
  <%- include('partials/header') %>
  <main>
    <div class="container">
      <h1><%= fileName %></h1>
      <div class="controls">
        <div class="controls-actions">
          <a href="/" class="btn">← Về trang chủ</a>
          <button id="btnRun" class="btn">Chạy</button>
          <button id="btnStop" class="btn btn-secondary">Dừng</button>
          <a href="/js/<%= fileName %>" download class="btn">Tải code về</a>
          <span id="status" style="color:#333;"></span>
        </div>
        <!-- Parameters -->
        <div class="control-card">
          <label for="stars_count">Số sao</label>
          <input id="stars_count" type="number" min="100" max="20000" step="100" value="2000">
          <div class="hint">Số lượng điểm sao nền</div>
        </div>
        <div class="control-card">
          <label for="planet_radius">Bán kính hành tinh</label>
          <input id="planet_radius" type="number" min="5" max="200" step="1" value="20">
          <div class="hint">Đường kính 2R (đơn vị Three)</div>
        </div>
        <div class="control-card">
          <label for="planet_texture">Ảnh bề mặt (URL)</label>
          <input id="planet_texture" type="text" value="https://i.imgur.com/UYb5hMP.jpg" placeholder="https://...jpg">
          <div class="hint">Đường dẫn ảnh texture</div>
        </div>
        <div class="control-card">
          <label for="ring_count">Số hạt vuông</label>
          <input id="ring_count" type="number" min="0" max="5000" step="50" value="800">
          <div class="hint">Số box quay quanh hành tinh</div>
        </div>
        <div class="control-card">
          <label for="ring_radius">Bán kính vòng</label>
          <input id="ring_radius" type="number" min="10" max="500" step="1" value="60">
          <div class="hint">Khoảng cách trung bình tới tâm</div>
        </div>
        <div class="control-card">
          <label for="ring_spread">Độ dày vòng</label>
          <input id="ring_spread" type="number" min="0" max="200" step="1" value="20">
          <div class="hint">Biên độ ngẫu nhiên ±spread</div>
        </div>
        <div class="control-card">
          <label for="ring_box_size">Kích thước box</label>
          <input id="ring_box_size" type="number" min="0.2" max="10" step="0.1" value="1">
          <div class="hint">Cỡ mỗi box vuông</div>
        </div>
        <div class="control-card">
          <label for="planet_speed">Tốc độ quay hành tinh</label>
          <input id="planet_speed" type="number" min="0" max="0.1" step="0.001" value="0.002">
          <div class="hint">Đơn vị rad/frame</div>
        </div>
        <div class="control-card">
          <label for="ring_speed">Tốc độ quay vòng</label>
          <input id="ring_speed" type="number" min="0" max="0.1" step="0.001" value="0.004">
          <div class="hint">Đơn vị rad/frame</div>
        </div>
        <div class="control-card">
          <label for="stars_speed">Tốc độ quay sao</label>
          <input id="stars_speed" type="number" min="0" max="0.01" step="0.0001" value="0.0005">
          <div class="hint">Đơn vị rad/frame</div>
        </div>
        <div class="control-card">
          <label for="camera_distance">Khoảng cách camera</label>
          <input id="camera_distance" type="number" min="20" max="1000" step="1" value="150">
          <div class="hint">Vị trí camera trục Z</div>
        </div>
        <div class="control-card">
          <label for="point_light">Cường độ đèn điểm</label>
          <input id="point_light" type="number" min="0" max="10" step="0.1" value="2">
          <div class="hint">Độ sáng nguồn đèn điểm</div>
        </div>
        <div class="control-card">
          <label for="ambient_light">Cường độ đèn nền</label>
          <input id="ambient_light" type="number" min="0" max="2" step="0.05" value="0.25">
          <div class="hint">Độ sáng ánh sáng môi trường</div>
        </div>
      </div>

  <div class="demo-container planet-demo" id="planet-root"></div>

      <!-- Hidden source code (removed per request) -->
    </div>
  </main>
  <%- include('partials/footer') %>

  <script src="/js/planet-scene.js"></script>
  <script>
    // Wire up run/stop buttons to the scene controller
    const statusEl = document.getElementById('status');
    function setStatus(msg){ if(statusEl) statusEl.textContent = msg || ''; }
    function collectSettings(){
      return {
        stars: { count: Number(document.getElementById('stars_count').value) || 2000 },
        planet: { radius: Number(document.getElementById('planet_radius').value) || 20, textureUrl: document.getElementById('planet_texture').value || '' },
        ring: {
          count: Number(document.getElementById('ring_count').value) || 800,
          radius: Number(document.getElementById('ring_radius').value) || 60,
          spread: Number(document.getElementById('ring_spread').value) || 20,
          boxSize: Number(document.getElementById('ring_box_size').value) || 1
        },
        speed: {
          planet: Number(document.getElementById('planet_speed').value) || 0.002,
          ring: Number(document.getElementById('ring_speed').value) || 0.004,
          stars: Number(document.getElementById('stars_speed').value) || 0.0005
        },
        camera: { distance: Number(document.getElementById('camera_distance').value) || 150 },
        lights: { point: Number(document.getElementById('point_light').value) || 2, ambient: Number(document.getElementById('ambient_light').value) || 0.25 }
      };
    }
    document.getElementById('btnRun')?.addEventListener('click', function(){
      const settings = collectSettings();
      if (window.PlanetScene && typeof window.PlanetScene.start === 'function') {
        window.PlanetScene.start(settings);
        setStatus('Đang chạy...');
      } else {
        setStatus('Không tìm thấy PlanetScene');
      }
    });
    document.getElementById('btnStop')?.addEventListener('click', function(){
      if (window.PlanetScene && typeof window.PlanetScene.stop === 'function') {
        window.PlanetScene.stop();
        setStatus('Đã dừng.');
      }
    });
  </script>
</body>
</html>
